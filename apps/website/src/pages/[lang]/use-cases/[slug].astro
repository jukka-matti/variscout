---
import BaseLayout from "../../../layouts/BaseLayout.astro";
import ScrollReveal from "../../../components/ScrollReveal.astro";
import UseCaseHero from "../../../components/UseCaseHero.astro";
import UseCaseProblem from "../../../components/UseCaseProblem.astro";
import UseCaseJourney from "../../../components/UseCaseJourney.astro";
import UseCaseBeforeAfter from "../../../components/UseCaseBeforeAfter.astro";
import UseCaseCTA from "../../../components/UseCaseCTA.astro";
import RelatedCases from "../../../components/RelatedCases.astro";
import { ui } from "../../../i18n/ui";
import { USE_CASES, getUseCaseBySlug, type UseCase } from "../../../data/useCaseData";

// React island component for demo chart
import ToolChartIsland from "../../../components/islands/ToolChartIsland";

export function getStaticPaths() {
	const languages = Object.keys(ui);
	const slugs = USE_CASES.map((uc) => uc.slug);

	return languages.flatMap((lang) =>
		slugs.map((slug) => ({
			params: { lang, slug },
			props: { useCase: getUseCaseBySlug(slug)! },
		}))
	);
}

interface Props {
	useCase: UseCase;
}

const { useCase } = Astro.props;
const { lang } = Astro.params;

// Map chart types to tool slugs for ToolChartIsland
const chartTypeToToolSlug: Record<string, string> = {
	'i-chart': 'i-chart',
	'boxplot': 'boxplot',
	'capability': 'capability',
	'pareto': 'pareto',
	'performance': 'performance',
};
---

<BaseLayout
	title={`${useCase.title} | VaRiScout`}
	description={useCase.metaDescription}
>
	{/* Section 1: Hero */}
	<UseCaseHero
		title={useCase.title}
		subtitle={useCase.subtitle}
		industry={useCase.industry}
		role={useCase.role}
		lang={lang as string}
	/>

	{/* Section 2: The Problem */}
	<ScrollReveal animation="fade-up">
		<UseCaseProblem
			headline={useCase.problem.headline}
			description={useCase.problem.description}
			misleadingMetric={useCase.problem.misleadingMetric}
			reality={useCase.problem.reality}
		/>
	</ScrollReveal>

	{/* Section 3: Interactive Demo */}
	<section class="py-16 bg-neutral-900">
		<div class="container-wide">
			<ScrollReveal animation="fade-up">
				<div class="text-center mb-8">
					<h2 class="text-2xl font-bold text-white mb-2">See It in Action</h2>
					<p class="text-neutral-400">{useCase.demo.caption}</p>
				</div>
				<div class="max-w-5xl mx-auto bg-slate-900 rounded-2xl overflow-hidden">
					<ToolChartIsland
						client:visible
						toolSlug={chartTypeToToolSlug[useCase.demo.chartType]}
						sampleKey={useCase.demo.sampleKey}
						height={500}
					/>
				</div>
			</ScrollReveal>
		</div>
	</section>

	{/* Section 4: The Journey */}
	<ScrollReveal animation="fade-up">
		<UseCaseJourney
			steps={useCase.journey}
			ahaQuote={useCase.ahaQuote}
			lang={lang as string}
		/>
	</ScrollReveal>

	{/* Section 5: Before / After */}
	<ScrollReveal animation="fade-up">
		<UseCaseBeforeAfter items={useCase.beforeAfter} />
	</ScrollReveal>

	{/* Related Case Studies */}
	{useCase.relatedCases.length > 0 && (
		<section class="py-16 bg-white border-b border-neutral-100">
			<div class="container-wide">
				<div class="max-w-3xl">
					<ScrollReveal animation="fade-up">
						<RelatedCases
							cases={useCase.relatedCases}
							title="See the Proof"
							lang={lang as string}
						/>
					</ScrollReveal>
				</div>
			</div>
		</section>
	)}

	{/* Section 6: What's Next + CTA */}
	<UseCaseCTA
		relatedCases={useCase.relatedCases}
		relatedTools={useCase.relatedTools}
		platformFit={useCase.platformFit}
		lang={lang as string}
	/>
</BaseLayout>
