---
/**
 * RelatedTools - Links to tool pages used in the case study
 *
 * @prop tools - Array of case chart IDs to display
 * @prop lang - Current language for links
 */

import { getToolBySlug } from "../data/toolsData";

type CaseChartId = 'ichart' | 'boxplot' | 'pareto' | 'stats' | 'regression' | 'gagerr';

interface Props {
	tools: CaseChartId[];
	lang: string;
}

const { tools, lang } = Astro.props;

// Map case chart IDs to tool page slugs
const CHART_TO_TOOL_SLUG: Record<CaseChartId, string | null> = {
	ichart: 'i-chart',
	boxplot: 'boxplot',
	pareto: 'pareto',
	stats: null,         // Stats panel has no dedicated tool page
	regression: 'regression',
	gagerr: 'gage-rr',
};

const TOOL_ICONS: Record<string, string> = {
	'i-chart': 'ðŸ“ˆ',
	boxplot: 'ðŸ“Š',
	pareto: 'ðŸ“‰',
	regression: 'ðŸ“',
	'gage-rr': 'ðŸŽ¯',
};

// Resolve each case chart ID to a tool page entry
const displayTools = tools
	.map(id => {
		const toolSlug = CHART_TO_TOOL_SLUG[id];
		if (!toolSlug) return null;
		const tool = getToolBySlug(toolSlug);
		if (!tool) return null;
		return { slug: tool.slug, name: tool.name, description: tool.hero.subtitle, icon: TOOL_ICONS[tool.slug] ?? 'ðŸ“Š' };
	})
	.filter(Boolean) as { slug: string; name: string; description: string; icon: string }[];
---

{displayTools.length > 0 && (
	<div class="mt-8 p-6 bg-neutral-50 border border-neutral-200 rounded-xl">
		<h3 class="text-sm font-bold text-neutral-400 uppercase tracking-wider mb-4">
			Tools Used in This Case
		</h3>
		<div class="grid gap-3 sm:grid-cols-2">
			{displayTools.map((tool) => (
				<a
					href={`/${lang}/tools/${tool.slug}`}
					class="group flex items-start gap-3 p-3 bg-white border border-neutral-200 rounded-lg hover:border-brand-primary hover:shadow-sm transition-all"
				>
					<span class="text-2xl" aria-hidden="true">{tool.icon}</span>
					<div>
						<span class="font-semibold text-neutral-900 group-hover:text-brand-primary transition-colors">
							{tool.name}
						</span>
						<p class="text-xs text-neutral-500 mt-0.5">{tool.description}</p>
					</div>
				</a>
			))}
		</div>
	</div>
)}
