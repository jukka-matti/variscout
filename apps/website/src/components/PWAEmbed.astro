---
import { ExternalLink, Maximize2 } from "lucide-astro";

interface Props {
	sampleKey: string;
	title?: string;
	height?: string;
}

const { sampleKey, title = "Interactive Analysis", height = "600px" } = Astro.props;

// Build the PWA URL with embed parameters
// In production, this would be https://variscout.com/app
// For local dev/monorepo, it's relative or absolute depending on deployment
const pwaUrl = `/app?sample=${sampleKey}&embed=true`;
const fullUrl = `/app?sample=${sampleKey}`;
---

<div class="w-full bg-white border border-neutral-200 rounded-2xl overflow-hidden shadow-lg group">
	<div class="px-4 py-3 bg-neutral-50 border-b border-neutral-200 flex items-center justify-between">
		<div class="flex items-center gap-2">
			<div class="flex gap-1.5">
				<div class="w-3 h-3 rounded-full bg-neutral-300"></div>
				<div class="w-3 h-3 rounded-full bg-neutral-300"></div>
				<div class="w-3 h-3 rounded-full bg-neutral-300"></div>
			</div>
			<span class="ml-2 text-xs font-medium text-neutral-500 uppercase tracking-wider">{title}</span>
		</div>
		<div class="flex items-center gap-3">
			<a 
				href={fullUrl} 
				target="_blank" 
				class="text-neutral-400 hover:text-brand-primary transition-colors p-1"
				title="Open in full app"
			>
				<ExternalLink size={16} />
			</a>
		</div>
	</div>
	
	<div class="relative overflow-hidden bg-neutral-900" style={`height: ${height}`}>
		<iframe 
			src={pwaUrl} 
			title={title}
			class="absolute inset-0 w-full h-full border-none"
			loading="lazy"
			allow="clipboard-read; clipboard-write; fullscreen"
		></iframe>
		
		<!-- Overlay for mobile/instruction -->
		<div class="absolute inset-0 bg-neutral-900/60 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none md:hidden">
			<span class="text-white text-sm font-medium px-4 py-2 border border-white/20 rounded-full backdrop-blur-md">
				Use on desktop for best experience
			</span>
		</div>
	</div>
	
	<div class="p-4 bg-white border-t border-neutral-200 flex items-center justify-between">
		<p class="text-xs text-neutral-500">
			Interactive preview. Click and drag in the charts to filter data.
		</p>
		<a href={fullUrl} class="text-xs font-semibold text-brand-primary hover:underline flex items-center gap-1">
			Go to Full App <Maximize2 size={12} />
		</a>
	</div>
</div>
